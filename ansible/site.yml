---
- name: Setup SSH key
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Write SSH private key from environment
      ansible.builtin.copy:
        content: "{{ lookup('env', 'SSH_PRIVATE_KEY') }}"
        dest: /tmp/ssh_key
        mode: "0600"
      check_mode: false

- name: Configure VPS
  hosts: vps
  become: true
  vars:
    repo_url: "{{ lookup('env', 'REPO_URL') | default('https://github.com/YOUR_USER/vps.git', true) }}"
    repo_branch: "{{ lookup('env', 'REPO_BRANCH') | default('main', true) }}"
    deploy_path: /opt/vps
    domain: "{{ lookup('env', 'TF_VAR_domain') }}"

  roles:
    - docker
    - firewall
    - deploy
