---
- name: Setup SSH key permissions
  hosts: localhost
  connection: local
  gather_facts: false
  tasks:
    - name: Copy SSH key with correct permissions
      copy:
        src: /mnt/workspace/ssh_key
        dest: /tmp/ssh_key
        mode: '0600'

- name: Configure VPS
  hosts: vps
  become: true
  vars:
    repo_url: "{{ lookup('env', 'REPO_URL') | default('https://github.com/YOUR_USER/vps.git', true) }}"
    repo_branch: "{{ lookup('env', 'REPO_BRANCH') | default('main', true) }}"
    deploy_path: /opt/vps
    domain: "{{ lookup('env', 'TF_VAR_domain') }}"

  roles:
    - docker
    - firewall
    - deploy
